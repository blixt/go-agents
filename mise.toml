[tools]
go = "1.25.7"
bun = "1.3.9"
watchexec = "latest"
golangci-lint = "latest"

[tasks.start]
description = "Run agentd server"
run = [
  "docker compose up --build --remove-orphans",
]

[tasks.dev]
description = "Auto-reload agentd on changes"
run = [
  "watchexec -r -w . -w ../go-llms --ignore web -- docker compose -f docker-compose.yml -f docker-compose.dev.yml up --build --remove-orphans",
]

[tasks.reset]
description = "Reset docker compose stack with force recreate"
run = [
  "docker compose down --remove-orphans",
  "docker compose up --build --force-recreate --remove-orphans -d",
]

[tasks.test]
description = "Run all tests"
run = [
  "env -u GOROOT go test ./...",
]

[tasks.format]
description = "Format + lint + vet"
run = [
  "env -u GOROOT gofmt -w $(find . -name '*.go' -not -path './vendor/*')",
  "env -u GOROOT go vet ./...",
  "golangci-lint run",
]
